<!DOCTYPE html>
<html lang="en-US" dir="ltr">

    <head>
        <!-- Header -->
        <script language="javascript" type="text/javascript" src="https://www.bbgatch.com/header.js"></script>
        <title>bbgatch | Forecasting TSA Data with R</title>
    </head>

    <body>
        <h1>Forecasting TSA Data with R</h1>
            <p><i>2024-09-27</i></p>
            
        <!-- TODO:
            Show the results of just ARIMA and ETS first and then show how adding combined improves results.
            Add coauthor name of the textbook
            Check alt text

        -->

            <p>If we want to create a forecast in R for the TSA Passenger data to predict passenger volumes in the future, we can use the <a href="https://tidyverts.org">tidyverts packages</a> `fable`, `tsibble`, and `feasts`.</p>

            <p>These packages apply <a href="https://r4ds.had.co.nz/tidy-data.html">tidy data principles</a> to time series data and forecasting. They were coauthored by the forecasting great <a href="https://robjhyndman.com">Rob Hyndman</a>. If you are interested in learning more about forecasting, I highly recommend Rob Hyndman and George Athanasopoulos's fantastic textbook: <a href="https://otexts.com/fpp3/">Forecasting: Principles and Practice (3rd Edition)</a>, which uses these tidyverts packages and workflows.</p>
            
            <h2>Plotting the History</h2>
                <p>The historical TSA Passenger data that we have looks like this:</p>
                <img src="images/tsa-passenger-history.png" alt="Line plot of TSA Passenger History." class="responsive" width="80%">

                <p><a href="https://www.bbgatch.com/projects/tsa/2024-08-27-how-much-history-to-use-forecasting-tsa-data/2024-08-27-how-much-history-to-use-forecasting-tsa-data.html">We recently learned</a> that our models will likely perform best if we ignore pre-Covid data and just assume history begins at April 2020. So we will use that in our model selection and final forecasts here.</p>
                
                <p>There is clear seasonality in the data, and there has been an upward trend coming out of the Covid downturn.</p>
                <img src="images/time-series-decomposition.png" alt="Line plots decomposing TSA Passenger History time series into trend, seasonality, and remainder components." class="responsive" width="80%">
                
            <h2>Evaluating Models with a Train/Test Split</h2>
                <p>The <code>fable</code> package provides several time series models to choose from. We can evaluate which models perform the best by breaking our data into separate train/test sets. We then fit each model on the training data, generate a forecast from each model over the test set time period, and we evaluate each model's forecast against our test set to measure accuracy.</p>
                
                <p></p>

                <!-- <img src="images/train-test-model-accuracy.png" alt="Terminal output of forecast model results." class="responsive" width="80%"> -->
                
                
                <p>The plain ARIMA model performs the best in terms of RMSE. This is using the Auto-ARIMA function that finds the best fitting ARIMA model to the data. The 4th and 5th best are the ETS models with additive error, trend (damped or not), and seasonality. The 2nd and 3rd best are combined models that average the results of the ARIMA and ETS(A, Ad, A) models and ARIMA and ETS(A, A, A) models.</p>

                <p>In this case the combined models slightly underperform the plain ARIMA model, but in many cases we can improve our accuracy by <a href="https://otexts.com/fpp3/combinations.html">combining two or more models.</a></p>
                <img src="images/train-test-model-accuracy.png" alt="Terminal output of forecast model results." class="responsive" width="80%">
                <img src="images/train-test-top-forecast-models.png" alt="Line plot showing performance of top forecast models." class="responsive" width="80%">

                <p>Based on these results we would likely pick the arima_ets_aada model for our final forecast. While the plain ARIMA model performed slightly better, we'd like to take advantage of the benefit of combining both ARIMA and ETS models - hopefully in the long term going forward that will perform better.</p>
                
            <h2>Evaluating Models with Cross Validation</h2>
                <p>Another approach to time series model evaluation is <a href="https://otexts.com/fpp3/tscv.html">cross validation</a>. This is a little different from cross validation you may have used in other machine learning contexts. With time series data, we start with an initial base set of historical data, fit our models, calculate forecasts, and measure accuracy. We then repeat adding one (or more) data point to the base historical data, repeating the model fitting, forecasting, and testing for each step with. In each step we're forecasting one or more steps out. Prof. Hyndman uses this visualization in his textbook</p>
                <img src="images/fpp3-cross-validation.png" alt="" class="responsive" width="80%">
                
                <p>One neat benefit of this approach, is that we can see the average model accuracy across all of the CV sets at 1 to 12 steps out. As we'd expect, model accuracy gets worse the further out we try to forecast. We can see that the best performing model across the CV sets is the ETS(A, Ad, A) model, and the second best is the combination of ARIMA and ETS(A, Ad, A).</p>
                <img src="images/cross-validation-forecast-error.png" alt="" class="responsive" width="80%">
            
            <h2>Final Forecast</h2>
                <p></p>
            
            
            
                         
            <h2>Conclusions</h2>
                <p></p>
            
            <a href="https://github.com/bbgatch/bbgatch.github.io/blob/main/projects/tsa/2024-09-20-forecasting-tsa-data-with-r/forecast.R">
            <h2>Full Code</h2>
            </a>
                <pre><code class="language-r">
                </code></pre>

        <!-- Footer -->
        <script language="javascript" type="text/javascript" src="https://www.bbgatch.com/footer.js"></script>

    </body>

</html>
